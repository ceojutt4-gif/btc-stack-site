<!DOCTYPE html>
<html>
<head>
  <title>BTC Stack Monitor</title>
  <style>
    body {
      background-color: #0d1117;
      color: white;
      font-family: monospace;
      margin: 0;
      padding: 20px;
    }

    #chatbox {
      height: 350px;
      border: 1px solid #30363d;
      padding: 10px;
      background: #010409;
      overflow-y: auto;
    }

    h2 {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<h2>BTC Buy / Sell Stack Monitor</h2>

<div id="chatbox">
  Connecting to live data...
</div>

<script>
const chatbox = document.getElementById("chatbox");

// Connect to Binance BTC/USDT order book
const ws = new WebSocket("wss://stream.binance.com:9443/ws/btcusdt@depth@100ms");

// Threshold for a "stack" in BTC
const STACK_THRESHOLD = 10; // Lower to see more alerts

// Cooldown map to prevent repeated alerts at same price
const cooldown = {}; 
const COOLDOWN_MS = 5000; // 5 seconds

// Round prices to nearest 5 USD for grouping
function roundPrice(price) {
  return Math.round(price / 5) * 5;
}

ws.onopen = () => {
  chatbox.innerHTML = "Connected! Waiting for live data...";
};

ws.onerror = (err) => {
  chatbox.innerHTML = "WebSocket error: " + err;
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);

  // Process buy orders (bids)
  data.bids.forEach(([price, size]) => {
    const p = roundPrice(parseFloat(price));
    const s = parseFloat(size);

    if (s >= STACK_THRESHOLD) {
      if (!cooldown[p]) {
        addMessage(`ðŸŸ¢ BUY STACK â†’ $${p} (${s.toFixed(2)} BTC)`);
        cooldown[p] = true;
        setTimeout(() => cooldown[p] = false, COOLDOWN_MS);
      }
    }
  });

  // Process sell orders (asks)
  data.asks.forEach(([price, size]) => {
    const p = roundPrice(parseFloat(price));
    const s = parseFloat(size);

    if (s >= STACK_THRESHOLD) {
      if (!cooldown[p]) {
        addMessage(`ðŸ”´ SELL STACK â†’ $${p} (${s.toFixed(2)} BTC)`);
        cooldown[p] = true;
        setTimeout(() => cooldown[p] = false, COOLDOWN_MS);
      }
    }
  });
};

// Function to add messages at the top
function addMessage(text) {
  const msg = document.createElement("div");
  const time = new Date().toLocaleTimeString();
  msg.textContent = `[${time}] ${text}`;
  chatbox.prepend(msg);
}
</script>

</body>
</html>
